<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta name="description" content="Визуализация данных, пошаговое руководство, книга по D3" />
		<meta name="keywords" content="code, art, design, data, visualization, generative, algorithmic, processing, d3, d3.js, book, maps, код, данные, искусство, визуализация, обработка данных, книга, отображение данных" />
		<meta name="author" content="Иванов Сергей" />
	
		<link rel="stylesheet" href="css/metro-bootstrap.css">
		<link rel="stylesheet" href="css/metro-bootstrap-responsive.css">
		<link rel="stylesheet" href="css/iconFont.css">
		<link rel="stylesheet" href="js/prettify/prettify.css">

        <script src="js/jquery/jquery.min.js"></script>
        <script src="js/jquery/jquery.widget.min.js"></script>
        <script src="js/jquery/jquery.mousewheel.js"></script>
		<script src="js/prettify/prettify.js"></script>
        <script src="js/metro/metro.min.js"></script>
		
		<script src="js/docs.js"></script>
		<script src="js/github.info.js"></script>
		<script type="text/javascript">
			var lNavigationDescriptor_obj_arr = [
				{
					pageName : "about.html",
					description : "Об этом руководстве",
					prevPageName : "",
					nextPageName : "fundamentals.html"
				},
				{
					pageName : "fundamentals.html",
					description : "Основы",
					prevPageName : "about.html",
					nextPageName : "setup.html"
				},
				{
					pageName : "setup.html",
					description : "Установка",
					prevPageName : "fundamentals.html",
					nextPageName : "adding_elements.html"
				},
				{
					pageName : "adding_elements.html",
					description : "Добавление элементов",
					prevPageName : "setup.html",
					nextPageName : "chaining_methods.html"
				},
				{
					pageName : "chaining_methods.html",
					description : "Цепочки методов",
					prevPageName : "adding_elements.html",
					nextPageName : "binding_data.html"
				},
				{
					pageName : "binding_data.html",
					description : "Привязка данных",
					prevPageName : "chaining_methods.html",
					nextPageName : "using_your_data.html"
				},
				{
					pageName : "using_your_data.html",
					description : "Использование данных",
					prevPageName : "binding_data.html",
					nextPageName : "drawing_divs.html"
				},
				{
					pageName : "drawing_divs.html",
					description : "Рисование с использованием блоков",
					prevPageName : "using_your_data.html",
					nextPageName : "power_of_data.html"
				},
				{
					pageName : "power_of_data.html",
					description : "Сила метода data()",
					prevPageName : "drawing_divs.html",
					nextPageName : "svg_primer.html"
				},
				{
					pageName : "svg_primer.html",
					description : "Пример с использованием SVG",
					prevPageName : "power_of_data.html",
					nextPageName : "drawing_svgs.html"
				},
				{
					pageName : "drawing_svgs.html",
					description : "Рисование с использованием SVG-элементов",
					prevPageName : "svg_primer.html",
					nextPageName : "types_of_data.html"
				},
				{
					pageName : "types_of_data.html",
					description : "Типы данных",
					prevPageName : "drawing_svgs.html",
					nextPageName : "making_bar_chart.html"
				},
				{
					pageName : "making_bar_chart.html",
					description : "Делаем столбиковую диаграмму",
					prevPageName : "types_of_data.html",
					nextPageName : "making_scatterplot.html"
				},
				{
					pageName : "making_scatterplot.html",
					description : "Делаем точечную диаграмму",
					prevPageName : "making_bar_chart.html",
					nextPageName : "scales.html"
				},
				{
					pageName : "scales.html",
					description : "Масштабирование",
					prevPageName : "making_scatterplot.html",
					nextPageName : "axes.html"
				},
				{
					pageName : "axes.html",
					description : "Координатные оси",
					prevPageName : "scales.html",
					nextPageName : ""
				}
			];
			
			function getPageProperty(aPageName_str, aPropertyName_str) {
				var lPagesCount_int = lNavigationDescriptor_obj_arr.length;
				for (var i = 0; i < lPagesCount_int; i++) {
					var lPageDescriptor_obj = lNavigationDescriptor_obj_arr[i];
					var lPGPageName_str = lPageDescriptor_obj.pageName;
					if (aPageName_str === lPGPageName_str) {
						return lPageDescriptor_obj[aPropertyName_str];
					}
				}
				return "";
			}
			
			window.onload = function () {
				var lPageName_str = location.href.match(/[^/]+\.html/i)[0];
				var lPagesCount_int = lNavigationDescriptor_obj_arr.length;
				for (var i = 0; i < lPagesCount_int; i++) {
					var lPageDescriptor_obj = lNavigationDescriptor_obj_arr[i];
					var lPGPageName_str = lPageDescriptor_obj.pageName;
					if (lPageName_str === lPGPageName_str) {
						var lPGPrevPageName_str = lPageDescriptor_obj.prevPageName;
						var lPGPrevPageDescription_str = getPageProperty(lPGPrevPageName_str, "description");
						var lPGNextPageName_str = lPageDescriptor_obj.nextPageName;
						var lPGNExtPageDescription_str = getPageProperty(lPGNextPageName_str, "description");
						
						var lTopNav_e = $("#top_navigation");
						var lBottomNav_e = $("#bottom_navigation");
						
						if (lPGPrevPageName_str.trim().length > 0) {
							var lPrevPageNav_e = $("<div class=\"span4\" align=\"center\"/>");
							var lLinkText_str = "<i class=\"icon-arrow-left-3\"></i>&nbsp;" + lPGPrevPageDescription_str;
							var lLink_e = $("<a class=\"seganav\" />").attr("href", lPGPrevPageName_str).html(lLinkText_str);
							lPrevPageNav_e.append(lLink_e);
							var lCopyPrevPageNav_e = lPrevPageNav_e.clone();
							lBottomNav_e.append(lPrevPageNav_e);
							lTopNav_e.append(lCopyPrevPageNav_e);
						}
						
						var lContentPageNav_e = $("<div align=\"center\"/>");
						if (lPGPrevPageName_str.trim().length > 0) {
							lContentPageNav_e.addClass("span4");
						} else {
							lContentPageNav_e.addClass("span4 offset4");
						}
						var lLinkText_str = "<i class=\"icon-book\"></i>&nbsp;" + "Оглавление";
						var lLink_e = $("<a class=\"seganav\" />").attr("href", "index.html").html(lLinkText_str);
						lContentPageNav_e.append(lLink_e);
						var lCopyContentPageNav_e = lContentPageNav_e.clone();
						lBottomNav_e.append(lContentPageNav_e);
						lTopNav_e.append(lCopyContentPageNav_e);
						
						if (lPGNextPageName_str.trim().length > 0) {
							var lNextPageNav_e = $("<div class=\"span4\" align=\"center\"/>");
							var lLinkText_str = lPGNExtPageDescription_str + "&nbsp;<i class=\"icon-arrow-right-3\"></i>";
							var lLink_e = $("<a class=\"seganav\" />").attr("href", lPGNextPageName_str).html(lLinkText_str);
							lNextPageNav_e.append(lLink_e);
							var lCopyNextPageNav_e = lNextPageNav_e.clone();
							lBottomNav_e.append(lNextPageNav_e);
							lTopNav_e.append(lCopyNextPageNav_e);
						}
						break;
					}
				}
				if (lPageName_str !== "index.html") {
					$("#top_navigation").show();
					$("#bottom_navigation").show();
				}
			};
		</script>
		<title>Рисование с использованием SVG-элементов</title>
	</head>
	<body class="metro">
		<div class="container">
			<div class="grid">
				<div class="row">
					<div class="span12">
						<div class="row bg-cyan" id="top_navigation" style="padding: 20px 0; display: none;">
						</div>
						
						<div align="center">
		<h1>Рисование с использованием SVG-элементов</h1>
	</div>
	<br/>
	<p>Мы знакомы с основной структурой SVG-изображения и его элементов. Как нам теперь начать генерировать фигуры из наших данных?</p>
	<p>Вы, наверное, заметили, что все свойства SVG-элементов задаются в виде атрибутов. Это значит, что они включены внутрь тега элемента в виде  ключ/значение, например:</p>
	<pre class="prettyprint linenums">&lt;element property="value"/&gt;</pre>
	<p>Хммм, уж больно сильно напоминает HTML:</p>
	<pre class="prettyprint linenums">&lt;p class="eureka"/&gt;</pre>
	<p>Мы уже использовали удобные методы append() и attr() из библиотеки D3 для создания новых HTML элементов и установки их атрибутов. Поскольку SVG-элементы являются частью DOM, так же как и HTML-элементы, мы можем использовать append() и attr() точно так же для создания SVG-изображений!</p>
	<br/>
	<h3>Создаем SVG</h3>
	<p>Первоначально, нам надо создать SVG-элемент, в который мы будем включать все наши фигуры.</p>
	<pre class="prettyprint linenums">d3.select("body").append("svg");</pre>
	<p>Этим кодом мы ищем элемент body и добавляем в него элемент SVG перед закрывающимся тегом </body>. Я рекомендую сделать так:</p>
	<pre class="prettyprint linenums">var svg = d3.select("body").append("svg");</pre>
	<p>Помните, сколько методов D3 возвращают ссылку на DOM-элементы, с которыми они работают? Путем создания переменной svg, мы можем запомнить ссылку, возвращенную методом append(). Считайте svg не просто "переменной", а "указателем на SVG-объект, который мы только что создали". Эта ссылка сохранит нам много кода далее. Вместо того, чтобы искать каждый раз элемент SVG кодом d3.select("svg"), мы просто используем ссылку svg.</p>
	<pre class="prettyprint linenums">
svg.attr("width", 500)
	.attr("height", 50);</pre>
	<p>Иначе, все могло бы быть записано в одной строке кода:</p>
	<pre class="prettyprint linenums">
var svg = d3.select("body")
            .append("svg")
            .attr("width", 500)
            .attr("height", 50);</pre>
	<p>Посмотрите <a href="http://alignedleft.com/content/03-tutorials/01-d3/110-drawing-svgs/1.html">демо-страницу с этим кодом</a>. Проинспектируйте DOM, и убедитесь, что пустой SVG-элемент в нее включен.</p>
	<p>Чтобы упростить вам жизнь, я рекомендую поместить в переменные значения width и height в начало вашего кода, как <a href="http://alignedleft.com/content/03-tutorials/01-d3/110-drawing-svgs/2.html">здесь</a>.</p>
	<pre class="prettyprint linenums">
//Width and height
var w = 500;
var h = 50;</pre>
	<p>Я это буду проделывать всегда с последующими примерами. Теперь я могу получить эти значения, попросту обратившись к переменным:</p>
	<pre class="prettyprint linenums">
var svg = d3.select("body")
            .append("svg")
            .attr("width", w)   // <-- Here
            .attr("height", h); // <-- and here!</pre>
	<br/>
	<h3>Фигуры на основе данных</h3>
	<p>Пришло время добавить несколько фигур. Я буду использовать наш первоначальный набор данных:</p>
	<pre class="prettyprint linenums">var dataset = [ 5, 10, 15, 20, 25 ];</pre>
	<p>а потом буду использовать метод data(), чтобы пройтись по каждому значению в нашем наборе, при этом создавая круг.</p>
	<pre class="prettyprint linenums">
svg.selectAll("circle")
    .data(dataset)
    .enter()
    .append("circle");</pre>
	<p>Запомните, что selectAll() вернет пустые ссылки на все круги(которые пока не существуют), data() привязывает значения к элементам, которые мы хотим создать, enter() возвращает ссылки на шаблоны новых элементов, а метод append() в конце-концов добавляет круги в DOM.</p>
	<p>Чтобы в последующем нам было проще ссылаться на созданные круги, мы создадим переменную, и в ней будем хранить ссылки на новые элементы:</p>
	<pre class="prettyprint linenums">
var circles = svg.selectAll("circle")
                 .data(dataset)
                 .enter()
                 .append("circle");</pre>
	<p>Великолепно, но всем этим кругам надо задать позицию и размер. Будьте осторожны, следующий код может взорвать ваш мозг:</p>
	<pre class="prettyprint linenums">
circles.attr("cx", function(d, i) {
            return (i * 50) + 25;
        })
       .attr("cy", h/2)
       .attr("r", function(d) {
            return d;
       });</pre>
	<img src="images/drawing_svgs_1.png" alt="Результат работы кода">
	<p>Насладитесь результатом на <a href="http://alignedleft.com/content/03-tutorials/01-d3/110-drawing-svgs/3.html">демо-странице</a>. Давайте по шагам разберем код:</p>
	<pre class="prettyprint linenums">
circles.attr("cx", function(d, i) {
            return (i * 50) + 25;
        })</pre>
	<p>Берем ссылку на все круги и устанавливаем атрибут cx каждому. Наши значения уже привязаны к элементам кругов, поэтому для каждого круга значение d соответствует необходимому значению в нашем первоначальном наборе данных(5, 10, 15, 20 и 25). Второе значение, i, также автоматически заполняется для нас. i хранит номер позиции(в наборе данных) текущего значения, соответствующего данному элементу. Номера позиций считаются с нуля, поэтому для нашего первого круга i == 0, для второго i == 1 и так далее. Мы используем i, чтобы  вставлять круги справа, потому что в каждом последующем цикле значение i увеличивается.</p>
	<pre class="prettyprint linenums">
(0 * 50) + 25 returns 25
(1 * 50) + 25 returns 75
(2 * 50) + 25 returns 125
(3 * 50) + 25 returns 175
(4 * 50) + 25 returns 225</pre>
	<p>Чтобы убедиться в том, что переменная i доступна внутри вашей функции, вы должны включить переменную в определение функции в качестве аргумента(function(d, i)). Также вы должны включить d, даже если вы не используете d в вашей функции(как в случае выше).</p>
	<p>На следующей строке:</p>
	<pre class="prettyprint linenums">.attr("cy", h/2)</pre>
	<p>h - это высота всего SVG-элемент, поэтому h/2 - это половина его высоты. Это сделано для того, чтобы круги были расположены в центре SVG-элемента по вертикали.</p>
	<pre class="prettyprint linenums">
.attr("r", function(d) {
    return d;
});</pre>
	<p>И в конце задается радиус круга, который соответствует значению d, которое в свою очередь является значением нашего набора данных, соответствующее кругу.</p>
	<br/>
	<h3>Приятные цвета</h3>
	<p>Цветовая закраска и рамка это всего лишь другие атрибуты, которые вы можете установить, используя те же методы. Просто, добавив этот код:</p>
	<pre class="prettyprint linenums">
.attr("fill", "yellow")
.attr("stroke", "orange")
.attr("stroke-width", function(d) {
    return d/2;
});</pre>
	<p>мы получим следующий результат:</p>
	<img src="images/drawing_svgs_2.png" alt="Результат работы кода">
	<p>Конечно, вы можете перемешивать и сопоставлять атрибуты и функции для применения некоторой комбинации свойств. Трюки с визуализацией данных, конечно, должны выбирать соответствующие сопоставления с данными, поэтому визуальное представление ваших данных является понятным и полезным для зрителей.</p>
						
						<div class="row bg-cyan" id="bottom_navigation" style="padding: 20px 0; display: none;">
						</div>
					</div>
				</div>
				<div class="row">
					<div class="span12" style="padding-top: 30px;">
						<p class="text-muted text-right">Автор перевода <a href="http://serganbus.github.io/">Иванов Сергей</a>. 2014 год</p>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
