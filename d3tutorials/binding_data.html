<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta name="description" content="Визуализация данных, пошаговое руководство, книга по D3" />
		<meta name="keywords" content="code, art, design, data, visualization, generative, algorithmic, processing, d3, d3.js, book, maps, код, данные, искусство, визуализация, обработка данных, книга, отображение данных" />
		<meta name="author" content="Иванов Сергей" />
	
		<link rel="stylesheet" href="css/metro-bootstrap.css">
		<link rel="stylesheet" href="css/metro-bootstrap-responsive.css">
		<link rel="stylesheet" href="css/iconFont.css">
		<link rel="stylesheet" href="js/prettify/prettify.css">

        <script src="js/jquery/jquery.min.js"></script>
        <script src="js/jquery/jquery.widget.min.js"></script>
        <script src="js/jquery/jquery.mousewheel.js"></script>
		<script src="js/prettify/prettify.js"></script>
        <script src="js/metro/metro.min.js"></script>
		
		<script src="js/docs.js"></script>
		<script src="js/github.info.js"></script>
		<script type="text/javascript">
			var lNavigationDescriptor_obj_arr = [
				{
					pageName : "about.html",
					description : "Об этом руководстве",
					prevPageName : "",
					nextPageName : "fundamentals.html"
				},
				{
					pageName : "fundamentals.html",
					description : "Основы",
					prevPageName : "about.html",
					nextPageName : "setup.html"
				},
				{
					pageName : "setup.html",
					description : "Установка",
					prevPageName : "fundamentals.html",
					nextPageName : "adding_elements.html"
				},
				{
					pageName : "adding_elements.html",
					description : "Добавление элементов",
					prevPageName : "setup.html",
					nextPageName : "chaining_methods.html"
				},
				{
					pageName : "chaining_methods.html",
					description : "Цепочки методов",
					prevPageName : "adding_elements.html",
					nextPageName : "binding_data.html"
				},
				{
					pageName : "binding_data.html",
					description : "Привязка данных",
					prevPageName : "chaining_methods.html",
					nextPageName : "using_your_data.html"
				},
				{
					pageName : "using_your_data.html",
					description : "Использование данных",
					prevPageName : "binding_data.html",
					nextPageName : "drawing_divs.html"
				},
				{
					pageName : "drawing_divs.html",
					description : "Рисование с использованием блоков",
					prevPageName : "using_your_data.html",
					nextPageName : "power_of_data.html"
				},
				{
					pageName : "power_of_data.html",
					description : "Сила метода data()",
					prevPageName : "drawing_divs.html",
					nextPageName : "svg_primer.html"
				},
				{
					pageName : "svg_primer.html",
					description : "Пример с использованием SVG",
					prevPageName : "power_of_data.html",
					nextPageName : "drawing_svgs.html"
				},
				{
					pageName : "drawing_svgs.html",
					description : "Рисование с использованием SVG-элементов",
					prevPageName : "svg_primer.html",
					nextPageName : "types_of_data.html"
				},
				{
					pageName : "types_of_data.html",
					description : "Типы данных",
					prevPageName : "drawing_svgs.html",
					nextPageName : "making_bar_chart.html"
				},
				{
					pageName : "making_bar_chart.html",
					description : "Делаем столбиковую диаграмму",
					prevPageName : "types_of_data.html",
					nextPageName : "making_scatterplot.html"
				},
				{
					pageName : "making_scatterplot.html",
					description : "Делаем точечную диаграмму",
					prevPageName : "making_bar_chart.html",
					nextPageName : "scales.html"
				},
				{
					pageName : "scales.html",
					description : "Масштабирование",
					prevPageName : "making_scatterplot.html",
					nextPageName : "axes.html"
				},
				{
					pageName : "axes.html",
					description : "Координатные оси",
					prevPageName : "scales.html",
					nextPageName : ""
				}
			];
			
			function getPageProperty(aPageName_str, aPropertyName_str) {
				var lPagesCount_int = lNavigationDescriptor_obj_arr.length;
				for (var i = 0; i < lPagesCount_int; i++) {
					var lPageDescriptor_obj = lNavigationDescriptor_obj_arr[i];
					var lPGPageName_str = lPageDescriptor_obj.pageName;
					if (aPageName_str === lPGPageName_str) {
						return lPageDescriptor_obj[aPropertyName_str];
					}
				}
				return "";
			}
			
			window.onload = function () {
				var lPageName_str = location.href.match(/[^/]+\.html/i)[0];
				var lPagesCount_int = lNavigationDescriptor_obj_arr.length;
				for (var i = 0; i < lPagesCount_int; i++) {
					var lPageDescriptor_obj = lNavigationDescriptor_obj_arr[i];
					var lPGPageName_str = lPageDescriptor_obj.pageName;
					if (lPageName_str === lPGPageName_str) {
						var lPGPrevPageName_str = lPageDescriptor_obj.prevPageName;
						var lPGPrevPageDescription_str = getPageProperty(lPGPrevPageName_str, "description");
						var lPGNextPageName_str = lPageDescriptor_obj.nextPageName;
						var lPGNExtPageDescription_str = getPageProperty(lPGNextPageName_str, "description");
						
						var lTopNav_e = $("#top_navigation");
						var lBottomNav_e = $("#bottom_navigation");
						
						if (lPGPrevPageName_str.trim().length > 0) {
							var lPrevPageNav_e = $("<div class=\"span4\" align=\"center\"/>");
							var lLinkText_str = "<i class=\"icon-arrow-left-3\"></i>&nbsp;" + lPGPrevPageDescription_str;
							var lLink_e = $("<a class=\"seganav\" />").attr("href", lPGPrevPageName_str).html(lLinkText_str);
							lPrevPageNav_e.append(lLink_e);
							var lCopyPrevPageNav_e = lPrevPageNav_e.clone();
							lBottomNav_e.append(lPrevPageNav_e);
							lTopNav_e.append(lCopyPrevPageNav_e);
						}
						
						var lContentPageNav_e = $("<div align=\"center\"/>");
						if (lPGPrevPageName_str.trim().length > 0) {
							lContentPageNav_e.addClass("span4");
						} else {
							lContentPageNav_e.addClass("span4 offset4");
						}
						var lLinkText_str = "<i class=\"icon-book\"></i>&nbsp;" + "Оглавление";
						var lLink_e = $("<a class=\"seganav\" />").attr("href", "index.html").html(lLinkText_str);
						lContentPageNav_e.append(lLink_e);
						var lCopyContentPageNav_e = lContentPageNav_e.clone();
						lBottomNav_e.append(lContentPageNav_e);
						lTopNav_e.append(lCopyContentPageNav_e);
						
						if (lPGNextPageName_str.trim().length > 0) {
							var lNextPageNav_e = $("<div class=\"span4\" align=\"center\"/>");
							var lLinkText_str = lPGNExtPageDescription_str + "&nbsp;<i class=\"icon-arrow-right-3\"></i>";
							var lLink_e = $("<a class=\"seganav\" />").attr("href", lPGNextPageName_str).html(lLinkText_str);
							lNextPageNav_e.append(lLink_e);
							var lCopyNextPageNav_e = lNextPageNav_e.clone();
							lBottomNav_e.append(lNextPageNav_e);
							lTopNav_e.append(lCopyNextPageNav_e);
						}
						break;
					}
				}
				if (lPageName_str !== "index.html") {
					$("#top_navigation").show();
					$("#bottom_navigation").show();
				}
			};
		</script>
		<title>Привязка данных</title>
	</head>
	<body class="metro">
		<div class="container">
			<div class="grid">
				<div class="row">
					<div class="span12">
						<div class="row bg-cyan" id="top_navigation" style="padding: 20px 0; display: none;">
						</div>
						
						<div align="center">
		<h1>Привязка данных</h1>
	</div>
	<br/>
	<p>Что значит привязка, и почему мне надо делать это со своими данными?</p>
	<p>Визуализация данных это процесс преобразования данных в визуальные образы. На входе получаем данные, на выходе свойства визуальных элементов. Возможно, большие числа должны соответствовать высоким столбцам, или специальные категории закрашиваться более яркими цветами. Правила преобразования данных в визуальные образы задаете вы сами.</p>
	<p>Благодаря D3 мы привязываем входные значения наших данных к DOM-элементам. Привязка - это прикрепление или ассоциация данных с конкретными элементами, чтобы в дальнейшем вы могли ссылаться на эти значения и применять правила преобразования. Без привязки данных мы имели бы кучу данных, которые просто так не сопоставить с DOM-элементами. Это никому не нужно.</p>
	<br/>
	<h3>В связке</h3>
	<p>Мы используем метод <a href="https://github.com/mbostock/d3/wiki/Selections#data">selection.data()</a> из библиотеки D3 для привязки данных к DOM-элементам. Но прежде чем мы это сделаем, нам нужны две вещи:</p>
	<ol>
		<li>Данные;</li>
		<li>Выборка из DOM-элементов.</li>
	</ol>
	<p>Давайте решать эти проблемы по очереди.</p>
	<br/>
	<h3>Данные</h3>
	<p>D3 невероятно умен, когда речь заходит об обработке данных. Так, D3 будет принимать любой массив чисел, строк или объектов(самих себя, содержащих другие массивы или пары ключзначение). D3 прекрасно обрабатывать JSON(и GeoJSON), в библиотеке даже есть специальный метод, чтобы помочь вам загрузить данные из CSV файлов.</p>
	<p>Но чтобы все было просто, мы начнем со скучного массива чисел. Ниже представлен наш простой набор данных:</p>
	<pre class="prettyprint linenums">var dataset = [ 5, 10, 15, 20, 25 ];</pre>
	<br/>
	<h3>Пожалуйста, сделайте вашу выборку</h3>
	<p>Первоначально вам надо решить, что выбирать. Дальше решить, с какими элементами будут ассоциироваться ваши данные. Снова, давайте разберем очень простой пример и представим, что мы хотим создать новый параграф для каждого значения в наборе данных. Вы можете предположить, что что-то вроде кода снизу будет нам полезно:</p>
	<pre class="prettyprint linenums">d3.select("body").selectAll("p")</pre>
	<p>и вы будете правы, но лишь с оговоркой: параграфы, которые мы выбираем, еще не существуют. И это является одним из источников путаницы в использовании D3: как мы можем выбрать элементы, которых еще нет? Потерпите немного, так как ответ может заставить вас поразмыслить.</p>
	<p>Ответ приходит в использовании метода enter(), который внатуре магический метод. Ниже представлен окончательный код для нашего примера:</p>
	<pre class="prettyprint linenums">
d3.select("body").selectAll("p")
    .data(dataset)
    .enter()
    .append("p")
    .text("New paragraph!");</pre>
	<p>Можете посмотреть, что делает этот код на <a href="http://alignedleft.com/content/03-tutorials/01-d3/60-binding-data/index.html">демо странице</a>. На странице можно увидеть пять параграфов с одним и тем же текстом внутри. Вот что случилось:</p>
	<p><i>d3.select("body")</i> - находит body элемент в DOM'e, и передает ссылку на него следующему методу в цепочке.</p>
	<p><i>.selectAll("p")</i> - выбирает все параграфы, расположенные в body. Так как они еще не существуют, то в выборке ничего нет. Эта пустая выборка должна представлять собой набор параграфов; они будут созданы вскоре.</p>
	<p><i>.data(dataset)</i> - считает количество значений и анализирует их. В нашем наборе 5 значений, так что все методы, вызываемые после этого, будут выполняться пять раз, то есть по разу на каждое значение.</p>
	<p><i>.enter()</i> - Чтобы создать новый, привязанный к данным элемент, мы используем метод enter(). Сначала метод смотрит на DOM, а потом на данные, переданные ему. Если данных больше, чем элементов, значит enter() создает новый промежуточный элемент. Дальше он возвращает ссылку на этот промежуточный элемент, после чего вызывается следующий метод.</p>
	<p><i>.append("p")</i> - берет промежуточный элемент, созданный с помощью метода enter(), и добавляет p-элемент вместо него в DOM. Ура, товарищи! Дальше метод возвращает ссылку на уже нормальный вновь созданный элемент, и мы переходим к следующему шагу в нашей цепочке.</p>
	<p><i>.text("New paragraph!")</i> - берет ссылку на вновь созданный p-элемент и вставляет в него текстовое значение.</p>
	<br/>
	<h3>Привязка и определение</h3>
	<p>Отлично! Наши данные прочитаны, проанализированы, и привязаны к новым элементам-p, которые мы создали в DOM'e. Не верите мне? Давайте вернемся к <a href="http://alignedleft.com/content/03-tutorials/01-d3/60-binding-data/index.html">демо странице</a> и посмотрим на нее через веб-инспектор.</p>
	<img src="images/binding_data_1.png" alt="Результат в веб-инспекторе"> 
	<p>Хорошо, я вижу 5 параграфов, но где же данные? Жмем на Console, вводим ниже JavaScript/D3 - код и жмем enter:</p>
	<pre class="prettyprint linenums">console.log(d3.selectAll("p"))</pre>
	<img src="images/binding_data_2.png" alt="Результат в веб-инспекторе"> 
	<p>Это массив! Жмем на маленький серый треугольник, чтобы увидеть подробности массива:</p>
	<img src="images/binding_data_3.png" alt="Результат в веб-инспекторе"> 
	<p>Вы заметите 5 HTMLParagraphElements, пронумерованные от 0 до 4х. Нажмите треугольник раскрытия у первого элемента(с индексом 0):</p>
	<img src="images/binding_data_4.png" alt="Результат в веб-инспекторе"> 
	<p>Видите это? Вы видите это? Я едва могу себя сдержать. Вот оно:</p>
	<img src="images/binding_data_5.png" alt="Результат в веб-инспекторе"> 
	<p>Первые элемент наших данных, представляющих массив, здесь! И он равен 5, как показано в атрибуте __data__ элемента HTMLParagraphElement. Нажмите на другие HTMLParagraph-элементы, что они тоже содержат атрибут __data__, который хранит значения: 10, 15, 20, 25, именно те, что мы указали!</p>
	<p>Вы видите, когда D3 привязывает данные к элементу, данные как таковые не существуют в DOM, но они запоминаются в атрибуте __data__ этого элемента. А консоль - это то место, где вы можете проверить привязаны ли ваши данные к конкретному элементу.</p>
	<p>С данными теперь порядок. Давайте же начнем делать что-нибудь с ними.</p>
						
						<div class="row bg-cyan" id="bottom_navigation" style="padding: 20px 0; display: none;">
						</div>
					</div>
				</div>
				<div class="row">
					<div class="span12" style="padding-top: 30px;">
						<p class="text-muted text-right">Автор перевода <a href="http://serganbus.github.io/">Иванов Сергей</a>. 2014 год</p>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
