<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta name="description" content="Визуализация данных, пошаговое руководство, книга по D3" />
		<meta name="keywords" content="code, art, design, data, visualization, generative, algorithmic, processing, d3, d3.js, book, maps, код, данные, искусство, визуализация, обработка данных, книга, отображение данных" />
		<meta name="author" content="Иванов Сергей" />
	
		<link rel="stylesheet" href="css/metro-bootstrap.css">
		<link rel="stylesheet" href="css/metro-bootstrap-responsive.css">
		<link rel="stylesheet" href="css/iconFont.css">
		<link rel="stylesheet" href="js/prettify/prettify.css">

        <script src="js/jquery/jquery.min.js"></script>
        <script src="js/jquery/jquery.widget.min.js"></script>
        <script src="js/jquery/jquery.mousewheel.js"></script>
		<script src="js/prettify/prettify.js"></script>
        <script src="js/metro/metro.min.js"></script>
		
		<script src="js/docs.js"></script>
		<script src="js/github.info.js"></script>
		<script type="text/javascript">
			var lNavigationDescriptor_obj_arr = [
				{
					pageName : "about.html",
					description : "Об этом руководстве",
					prevPageName : "",
					nextPageName : "fundamentals.html"
				},
				{
					pageName : "fundamentals.html",
					description : "Основы",
					prevPageName : "about.html",
					nextPageName : "setup.html"
				},
				{
					pageName : "setup.html",
					description : "Установка",
					prevPageName : "fundamentals.html",
					nextPageName : "adding_elements.html"
				},
				{
					pageName : "adding_elements.html",
					description : "Добавление элементов",
					prevPageName : "setup.html",
					nextPageName : "chaining_methods.html"
				},
				{
					pageName : "chaining_methods.html",
					description : "Цепочки методов",
					prevPageName : "adding_elements.html",
					nextPageName : "binding_data.html"
				},
				{
					pageName : "binding_data.html",
					description : "Привязка данных",
					prevPageName : "chaining_methods.html",
					nextPageName : "using_your_data.html"
				},
				{
					pageName : "using_your_data.html",
					description : "Использование данных",
					prevPageName : "binding_data.html",
					nextPageName : "drawing_divs.html"
				},
				{
					pageName : "drawing_divs.html",
					description : "Рисование с использованием блоков",
					prevPageName : "using_your_data.html",
					nextPageName : "power_of_data.html"
				},
				{
					pageName : "power_of_data.html",
					description : "Сила метода data()",
					prevPageName : "drawing_divs.html",
					nextPageName : "svg_primer.html"
				},
				{
					pageName : "svg_primer.html",
					description : "Пример с использованием SVG",
					prevPageName : "power_of_data.html",
					nextPageName : "drawing_svgs.html"
				},
				{
					pageName : "drawing_svgs.html",
					description : "Рисование с использованием SVG-элементов",
					prevPageName : "svg_primer.html",
					nextPageName : "types_of_data.html"
				},
				{
					pageName : "types_of_data.html",
					description : "Типы данных",
					prevPageName : "drawing_svgs.html",
					nextPageName : "making_bar_chart.html"
				},
				{
					pageName : "making_bar_chart.html",
					description : "Делаем столбиковую диаграмму",
					prevPageName : "types_of_data.html",
					nextPageName : "making_scatterplot.html"
				},
				{
					pageName : "making_scatterplot.html",
					description : "Делаем точечную диаграмму",
					prevPageName : "making_bar_chart.html",
					nextPageName : "scales.html"
				},
				{
					pageName : "scales.html",
					description : "Масштабирование",
					prevPageName : "making_scatterplot.html",
					nextPageName : "axes.html"
				},
				{
					pageName : "axes.html",
					description : "Координатные оси",
					prevPageName : "scales.html",
					nextPageName : ""
				}
			];
			
			function getPageProperty(aPageName_str, aPropertyName_str) {
				var lPagesCount_int = lNavigationDescriptor_obj_arr.length;
				for (var i = 0; i < lPagesCount_int; i++) {
					var lPageDescriptor_obj = lNavigationDescriptor_obj_arr[i];
					var lPGPageName_str = lPageDescriptor_obj.pageName;
					if (aPageName_str === lPGPageName_str) {
						return lPageDescriptor_obj[aPropertyName_str];
					}
				}
				return "";
			}
			
			window.onload = function () {
				var lPageName_str = location.href.match(/[^/]+\.html/i)[0];
				var lPagesCount_int = lNavigationDescriptor_obj_arr.length;
				for (var i = 0; i < lPagesCount_int; i++) {
					var lPageDescriptor_obj = lNavigationDescriptor_obj_arr[i];
					var lPGPageName_str = lPageDescriptor_obj.pageName;
					if (lPageName_str === lPGPageName_str) {
						var lPGPrevPageName_str = lPageDescriptor_obj.prevPageName;
						var lPGPrevPageDescription_str = getPageProperty(lPGPrevPageName_str, "description");
						var lPGNextPageName_str = lPageDescriptor_obj.nextPageName;
						var lPGNExtPageDescription_str = getPageProperty(lPGNextPageName_str, "description");
						
						var lTopNav_e = $("#top_navigation");
						var lBottomNav_e = $("#bottom_navigation");
						
						if (lPGPrevPageName_str.trim().length > 0) {
							var lPrevPageNav_e = $("<div class=\"span4\" align=\"center\"/>");
							var lLinkText_str = "<i class=\"icon-arrow-left-3\"></i>&nbsp;" + lPGPrevPageDescription_str;
							var lLink_e = $("<a class=\"seganav\" />").attr("href", lPGPrevPageName_str).html(lLinkText_str);
							lPrevPageNav_e.append(lLink_e);
							var lCopyPrevPageNav_e = lPrevPageNav_e.clone();
							lBottomNav_e.append(lPrevPageNav_e);
							lTopNav_e.append(lCopyPrevPageNav_e);
						}
						
						var lContentPageNav_e = $("<div align=\"center\"/>");
						if (lPGPrevPageName_str.trim().length > 0) {
							lContentPageNav_e.addClass("span4");
						} else {
							lContentPageNav_e.addClass("span4 offset4");
						}
						var lLinkText_str = "<i class=\"icon-book\"></i>&nbsp;" + "Оглавление";
						var lLink_e = $("<a class=\"seganav\" />").attr("href", "index.html").html(lLinkText_str);
						lContentPageNav_e.append(lLink_e);
						var lCopyContentPageNav_e = lContentPageNav_e.clone();
						lBottomNav_e.append(lContentPageNav_e);
						lTopNav_e.append(lCopyContentPageNav_e);
						
						if (lPGNextPageName_str.trim().length > 0) {
							var lNextPageNav_e = $("<div class=\"span4\" align=\"center\"/>");
							var lLinkText_str = lPGNExtPageDescription_str + "&nbsp;<i class=\"icon-arrow-right-3\"></i>";
							var lLink_e = $("<a class=\"seganav\" />").attr("href", lPGNextPageName_str).html(lLinkText_str);
							lNextPageNav_e.append(lLink_e);
							var lCopyNextPageNav_e = lNextPageNav_e.clone();
							lBottomNav_e.append(lNextPageNav_e);
							lTopNav_e.append(lCopyNextPageNav_e);
						}
						break;
					}
				}
				if (lPageName_str !== "index.html") {
					$("#top_navigation").show();
					$("#bottom_navigation").show();
				}
			};
		</script>
		<title>Делаем точечную диаграмму</title>
	</head>
	<body class="metro">
		<div class="container">
			<div class="grid">
				<div class="row">
					<div class="span12">
						<div class="row bg-cyan" id="top_navigation" style="padding: 20px 0; display: none;">
						</div>
						
						<div align="center">
		<h1>Делаем точечную диаграмму</h1>
	</div>
	<br/>
	<p>Итак, мы нарисовали только столбиковую диаграмму с набором простых данных - просто одномерный набор цифр.</p>
	<p>Но когда у вас есть два набора данных, которые надо отобразить, вам понадобится второе изменение. Точечная диаграмма представляет собой общепринятую визуализацию, которая отображает два набора связанных значений на двух осях: горизонтальной и вертикальной, <i>х</i> и <i>у</i>.</p>
	<br/>
	<h3>Данные</h3>
	<p>Как вы видели в главе "Типы данных", вы практически не ограничены в выборе структуры значений, содержащейся в вашем наборе данных. Для нашей точечной диаграммы, я собираюсь использовать массив массивов. Основной массив будет содержать по одному элементу для каждой "точки". Каждая из этих "точек" будет представлена другим массивом, который хранит два значения: один для <i>х</i>, второй для <i>y</i>.</p>
	<pre class="prettyprint linenums">
var dataset = [
                [5, 20], [480, 90], [250, 50], [100, 33], [330, 95],
                [410, 12], [475, 44], [25, 67], [85, 21], [220, 88]
              ];</pre>
	<p>Помните, <i>[]</i> означает массив, соответственно, вложенные квадратные скобки <i>[[]]</i> означают массив внутри массива. Мы отделяем элементы массива запятыми, поэтому массив, содержащий три других массива будет выглядеть приблизительно так: <i>[[],[],[]]</i>.</p>
	<p>Мы можем переписать наш набор данных по-другому, для большей наглядности:</p>
	<pre class="prettyprint linenums">
var dataset = [
                  [ 5,     20 ],
                  [ 480,   90 ],
                  [ 250,   50 ],
                  [ 100,   33 ],
                  [ 330,   95 ],
                  [ 410,   12 ],
                  [ 475,   44 ],
                  [ 25,    67 ],
                  [ 85,    21 ],
                  [ 220,   88 ]
              ];</pre>
	<p>Теперь мы видим, что каждой из 10 строк будет соответствовать одна точка в нашей визуализации. Например, в строке <i>[5, 20]</i>, мы будем использовать 5 как координату <i>х</i>, а 20 - как <i>у</i>.</p>
	<br/>
	<h3>Точечная диаграмма</h3>
	<p>Давайте перенесем большую часть кода из реализации нашей столбиковой диаграммы, в том числе кусок кода, который создает SVG-элемент:</p>
	<pre class="prettyprint linenums">
//Create SVG element
var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);</pre>
	<p>Вместо создания прямоугольников, мы будем создавать по кругу для каждого значения в наборе данных:</p>
	<pre class="prettyprint linenums">svg.selectAll("circle")
   .data(dataset)
   .enter()
   .append("circle")</pre>
	<p>Также, теперь мы будем указывать и атрибуты, соответствующие кругу<i>(cx, cy, r)</i>, а не прямоугольнику:</p>
	<pre class="prettyprint linenums">
.attr("cx", function(d) {
        return d[0];
   })
   .attr("cy", function(d) {
        return d[1];
   })
   .attr("r", 5);</pre>
	<img src="images/making_scatterplot_1.png" alt="Результат работы кода">
	<p><a href="http://alignedleft.com/content/03-tutorials/01-d3/140-making-a-scatterplot/1.html">Страница с результатом выполнения кода.</a></p>
	<p>Заметьте, как мы получаем доступ к значениям данных, и используем их для атрибутов круга <i>cx</i> и <i>cy</i>. При использовании <i>function(d)</i>, D3 автоматически представляет текущее значение в аргументе функции с именем <i>d</i>. Таким образом, текущее значение представляет маленький массив в нашем большом наборе данных.</p>
	<p>Когда <i>d</i> является массивом значений(а не единичным значением, например, 3.14159), для доступа к его значениям необходимо использовать квадратные скобки. Следовательно, вместо того, чтобы писать <i>return d</i>, мы пишем <i>return d[0]</i> и <i>return d[1]</i>, и, соответственно, возвращаем первое и второе значения массива.</p>
	<p>Например, в нашей первой точке набора данных <i>[5, 20]</i>, первое значение(индекс массива 0) равен 5, второе значение(индекс массива 1) равно 20. Таким образом:</p>
	<pre class="prettyprint linenums">
d[0] returns 5
d[1] returns 20</pre>
	<p>Кстати, если вам когда-нибудь понадобится получить доступ к любому значению в большом наборе данных(без использования D3), вы можете сделать это также, с использованием квадратных скобок:</p>
	<pre class="prettyprint linenums">dataset[5] returns [410, 12]</pre>
	<p>Для быстрого доступа к значению вложенного массива сперва указывается индекс основного массива, потом указывается индекс массива, где хранится непосредственное значение:</p>
	<pre class="prettyprint linenums">dataset[5][1] returns 12</pre>
	<p>Не верите мне? Взгляните по-другому на <a href="http://alignedleft.com/content/03-tutorials/01-d3/140-making-a-scatterplot/1.html">точечную диаграму</a>, откройте JavaScript-консоль, и введите сперва <i>dataset[5]</i>, а потом <i>dataset[5][1]</i>, и увидите, что случится.</p>
	<br/>
	<h3>Размер</h3>
	<p>Возможно, вы захотите, чтобы ваши круги имели разные размеры, чтобы, например, радиус круга зависел от <i>y</i>. Тогда можно попробовать такой код:</p>
	<pre class="prettyprint linenums">
.attr("r", function(d) {
    return Math.sqrt(h - d[1]);
});</pre>
	<img src="images/making_scatterplot_2.png" alt="Результат работы кода">
	<p><a href="http://alignedleft.com/content/03-tutorials/01-d3/140-making-a-scatterplot/2.html">Полученный результат</a> не является ни полезным, ни красивым, но он показывает, как вы можете использовать <i>d</i> с квадратными скобками, и как увязать значение данных с радиусом рисуемого круга.</p>
	<br/>
	<h3>Метки</h3>
	<p>Давайте пометим наши точки на диаграмме с помощью элементов <i>text</i>. Я адаптирую код для создания меток для столбиковой диаграммы, который начинается так:</p>
	<pre class="prettyprint linenums">
svg.selectAll("text")
   .data(dataset)
   .enter()
   .append("text")</pre>
	<p>Этот код ищет все <i>text</i>-элементы в SVG(которых пока нет), а потом добавляет новые текстовые элементы для каждого значения из набора данных. Используйте метод <i>text()</i> для задания текста для каждого элемента <i>text</i>:</p>
	<pre class="prettyprint linenums">
.text(function(d) {
        return d[0] + "," + d[1];
   })</pre>
	<p>Немного сумбурно, но потерпите. И снова, используем <i>function(d)</i> для получения доступа к каждому значению набора данных. Далее, с использованием этой функции, мы используем <i>d[0]</i> и <i>d[1]</i> для получения значений массива, описывающего точку.</p>
	<p>Символ "+", который в конкретном случае поставлен перед строкой ",", используется для объединения строк. Так эта строка кода делает: берет значения из <i>d[0]</i> и <i>d[1]</i>, объединяет их в строку, в которой посередине будет находиться ",". В итоге, результат долен выглядеть примерно так: "5,20" или "25,67".</p>
	<p>Дальше мы должны указать, где текст должен быть расположен. Это делается путем задания атрибутов текста <i>x</i> и <i>y</i>. Для этого мы будем использовать значения <i>d[0]</i> и <i>d[1]</i>, их же мы используем для указания центра окружности:</p>
	<pre class="prettyprint linenums">
   .attr("x", function(d) {
        return d[0];
   })
   .attr("y", function(d) {
        return d[1];
   })</pre>
	<p>И в конце добавляем несколько стилей для шрифта:</p>
	<pre class="prettyprint linenums">
   .attr("font-family", "sans-serif")
   .attr("font-size", "11px")
   .attr("fill", "red");</pre>
	<img src="images/making_scatterplot_3.png" alt="Результат работы кода">
	<p><a href="http://alignedleft.com/content/03-tutorials/01-d3/140-making-a-scatterplot/3.html">Здесь представлен результат рабочего кода.</a></p>
	<br/>
	<h3>Что дальше?</h3>
	<p>Я надеюсь, что некоторые основные концепции, заложенные в ядро D3, вам понятны: загрузка данных, создание новых элементов, использование данных для указания атрибутов созданных элементов.</p>
	<p>Тем не менее, изображение выше едва ли тянет на то, чтобы называться визуализацией данных. Точечную диаграмму сложно воспринимать, а код не так уж и гибко использует данные. Честно говоря, мы еще не превзошли мастер диаграмм от Excel.</p>
	<p>Не беспокойтесь: D3 куда круче мастера диаграмм от Excel(не говоря уже о Clippy), но для того, чтобы генерировать блестящие интерактивные диаграммы, наш навык использования D3 должен быть на совершенно ином уровне. Для более гибкого использования наших данных мы поговорим о масштабировании в D3. Чтобы наша точечная диаграмма была более наглядна, мы научимся строить оси и указывать метки на них. Следующим шагом, который мы сделаем для создания по-настоящему интерактивых диаграмм, будет умение обновлять данные на лету.</p>
						
						<div class="row bg-cyan" id="bottom_navigation" style="padding: 20px 0; display: none;">
						</div>
					</div>
				</div>
				<!--div class="row">
					<div class="span12">
						<div id="disqus_thread"></div>
					</div>
				</div-->
				<div class="row">
					<div class="span12" style="padding-top: 30px; text-align:right;">
						<span class="text-muted">Автором оригинального текста книги <a href="http://alignedleft.com/tutorials/d3">D3 Tutorials</a> является <a href="http://alignedleft.com/">Scott Murray</a></span>
						<br/>
						<span class="text-muted">На русский язык перевел <a href="http://serganbus.github.io/">Ivanov Sergey</a>. 2014 год</span>
					</div>
				</div>
			</div>
		</div>
		
		<!--script type="text/javascript">
		var lPageName_str = location.href.match(/[^/]+\.html/i)[0];
		var lPageDescription_str = getPageProperty(lPageName_str, "description");
		
		/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = "serganbus"; // required: replace example with your forum shortname
		var disqus_identifier = "http://serganbus.github.io//d3tutorials/" + lPageName_str;
		var disqus_url = "http://serganbus.github.io//d3tutorials/" + lPageName_str;
		var disqus_category_id = "3309433";
		
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
		</script-->
		
	</body>
</html>
