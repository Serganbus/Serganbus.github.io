---
layout: post
title: "Продвинутая столбиковая диаграмма с использованием D3.js"
date: 2014-12-13 23:49:49 +0600
comments: true
categories: [javascript, d3js, visualization]
---
Приветствую!
Сегодня мы поговорим об обязательных атрибутах продвинутой столбиковой диграммы и о том, как ее реализовывать с использованием библиотеки визуализации данных D3.js. В моем переводе краткого руководства уже затрагивалась тема построения столбиковой диаграммы, однако продвинутой ее назвать язык просто не поворачивается. Кто еще не читал это краткое руководство, оно находится [здесь](http://serganbus.github.io/d3tutorials/making_bar_chart.html).

Допустим, нам необходимо показать, сколько денег мы тратим каждый день в течении месяца. Логично, что для этого дела мы выбрали столбиковую диаграмму. Для начала определимся, что же из себя представляет продвинутая столбиковая диаграмма? Минимальным набором для такой диаграммы является набор столбиков, оси и метки на осях. Хорошо если диаграмма будет иметь легенду(по-русски: подпись). Еще лучше, если диаграмма будет интерактивная. Представьте: наводишь мышью на столбик, а он подсвечивается, да еще и отображается посказка, какое значение отображает этот столбик! И верхом всего будет продвинутая интерактивность. Давайте же выполним задуманное.
<!-- more -->
Делаем все по порядку. 
#### Этап 1. Простая диаграмма
Сначала реализуем диаграмму с минимальным набором. Тут расписывать нечего, так как пользуемся лишь знаниями, полученными при чтении [переведенного руководства](http://serganbus.github.io/d3tutorials/index.html).
Сразу выявляется недочет: подписи на горизонтальной оси накладываются друг на другу, тем самым не давая себя прочитать. Если мы проанализируем в web-inspector'e, из чего состоит одна метка на оси, то увидим следующее:
{% img center /images/posts/advanced_bar_chart_1.jpg 602 172 'Web Inspector' 'Web Inspector' %}
То есть, метка состоит из линии и подписи. И подпись у нас никак не корректируется в зависимости от ширины столбика. Выглядит ужасно и очень не информативно. Чтобы это исправить, нам нужно сделать так, чтобы подпись для каждого столбика корректировалась в зависимости от ширины этого столбика.  Концептуально можно выделить такую последовательность действия для решения этой задачи:   
1. Выбираем все метки на горизонтальной оси методом [d3.selectAll()](https://github.com/mbostock/d3/wiki/Selections#d3_selectAll);   
2. Поворачиваем подпись метки на такой угол, чтобы ее ширина была соизмерима с шириной столбика;   
3. Позиционируем подпись метки так, чтобы было ясно, к какому столбику она относится;   
Пункты 2 и 3 технически будут реализованы в методе с названием *tickTextWrapping*. Здесь вдаваться в подробности реализации не будем. Итак, смотрим на полученный [результат](http://jsfiddle.net/Serganbus/0gbjxqf2/1/).   
Теперь если мы добавим хоть данные о тратах за все дни месяца, у нас все равно получится очень красивая и наглядная диаграмма. [Полученный результат](http://jsfiddle.net/Serganbus/0gbjxqf2/2/).
#### Этап 2. Добавляем легенду
Для большей информативности добавим легенду. [Результат с легендой](http://jsfiddle.net/Serganbus/0gbjxqf2/3/).   
Еще приятнее и информативнее стала выглядеть наша диаграмма.
#### Этап 3. Добавляем интерактивность
Сделаем так, чтобы при наведении мышкой на столбик он выделялся. Это делается простым добавлением CSS-стилей. [Результат](http://jsfiddle.net/Serganbus/0gbjxqf2/4/).   
Для достижения большей интерактивности сделаем так, чтобы при наведении мышкой столбик не только выделялся, но и отображалась сверху подсказка со значением столбика. [Результат](http://jsfiddle.net/Serganbus/0gbjxqf2/5/).